<!DOCTYPE html>

<html>
<head>
  <title>Relationship Controllers</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Relationship Controller</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../db/database.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>The createRelationship method creates a directed edge between two users. It takes a
userId, targetId, and a relationship in the request object. Creating a relationship that points from the user to to the
target.
The return value is the relationship data returned from the database.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports.createRelationship = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">var</span> params = req.body;
  <span class="hljs-keyword">var</span> queryString = <span class="hljs-string">'MATCH (user:Person {facebookId : {userId}}), (target:Person {facebookId : {targetId}}) CREATE (user)-[tag:'</span> + params.relationship + <span class="hljs-string">' ]-&gt; (target) RETURN tag'</span>;
  db.cypherQuery(queryString, params, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, response</span>)</span>{
    <span class="hljs-keyword">if</span>(err){
      res.status(<span class="hljs-number">404</span>).json(err);
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">201</span>).json(response.results[<span class="hljs-number">0</span>]);
    }
  });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>example request body object for the createRelationship method. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      {
        userId: <span class="hljs-string">"32416340"</span>,
        targetId: <span class="hljs-string">"123451654"</span>,
        relationship: <span class="hljs-string">"friends"</span>
       }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>The deleteRelationship method takes a request body object with userId, targetId, and relationship information and deletes the relationship from the database.
The response object is just confirmatio from the database that the relationship is deleted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports.deleteRelationship = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">var</span> params = {
    userId : req.body.userId,
    targetId : req.body.targetId
  };
  <span class="hljs-keyword">var</span> queryString = <span class="hljs-string">'MATCH (user:Person {facebookId : {userId}})-[rel:'</span> + req.body.relationship + <span class="hljs-string">']-&gt;(target:Person {facebookId : {targetId}}) DELETE rel'</span>;
  db.cypherQuery(queryString, params, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, response</span>)</span>{
    <span class="hljs-keyword">if</span>(err){
      res.status(<span class="hljs-number">404</span>).json(err);

    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">201</span>).json(response);
    }
  });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>example request body object for the delete relationship method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      {
       userId: <span class="hljs-number">32416340</span>,
       targetId: <span class="hljs-number">123451654</span>,
       relationship: <span class="hljs-string">"friends"</span>,
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>The getUserInArea method references the database to ensure that the second user is not blocked or
selected by the user, or that the second person has not blocked the user.
If the user information passes the filter, it is returned in the body of the response object
Instead of keeping the information in the request body, the request needs
to have the information stored in the url in the form of a query string.
The query string needs to have an id parameter as well as a userInArea
parameter. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports.getUserInArea = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">var</span> params = {
    facebookId : req.query.id,
    targetId : req.query.userInArea
  };
  <span class="hljs-keyword">var</span> queryString = <span class="hljs-string">'MATCH (user:Person {facebookId : {facebookId} }), (target:Person {facebookId: {targetId} }) WHERE NOT user-[:blocked]-target AND NOT user-[:selected]-target return target'</span>;
  db.cypherQuery(queryString, params, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, response</span>) </span>{
    <span class="hljs-keyword">if</span>(err || !response.results[<span class="hljs-number">0</span>].data[<span class="hljs-number">0</span>]){
      res.status(<span class="hljs-number">404</span>).json(err);
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">200</span>).json(response.results[<span class="hljs-number">0</span>].data[<span class="hljs-number">0</span>].row[<span class="hljs-number">0</span>]);
    }
  });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>example query for the getUserInArea method. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    GET <span class="hljs-string">"https://powerful-sea-68331.herokuapp.com/api/users/?id=819234724078&amp;userInArea=2986437245"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Gets all users that are associated with another user based on a specified
relationship regardless of the direction of the relationship. The
information needs to be added to the url as query parameters. The response is an array
of user profiles.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports.getConnections = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">var</span> params = {
    facebookId : req.query.id,
    relationship : req.query.relationship
  };
  <span class="hljs-keyword">var</span> queryString = <span class="hljs-string">'MATCH (user:Person {facebookId : {facebookId} }), (target:Person) WHERE user-[:'</span> + params.relationship + <span class="hljs-string">']-target return target'</span>;
  db.cypherQuery(queryString, params, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, response</span>) </span>{
    <span class="hljs-keyword">if</span>(err){
      res.status(<span class="hljs-number">404</span>).json(err);
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">200</span>).json(response.results[<span class="hljs-number">0</span>].data);
    }
  });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>example query for the get connections method. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    GET <span class="hljs-string">"https://powerful-sea-68331.herokuapp.com/api/relationship/?id=819234724078&amp;relationship=friends"</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
